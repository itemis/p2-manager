<h2 class="m-2">Search Installable Units</h2>
<div layout="row" layout-align="space-between center">
  <div flex>
    <md-input-container ng-submit="$ctrl.searchUnits()" name="searchUnitsForm">
      <input name="unitId" id="unitId" ng-model="$ctrl.unitSearchField.keywords" ng-model-options="{debounce:300}" ng-pattern='$ctrl.unitIdFormat' ng-change="$ctrl.searchUnits()">
    </md-input-container>
  </div>
  <div>
    <md-button class="md-primary md-raised" ng-click="$ctrl.searchUnits()">Search</md-button>
  </div>
</div>

<md-content>
  <!-- md-virtual-repeat-container, div md-virtual-repeat="unit in units" md-on-demand class="repeated-item" -->
  <ul class="list-group" infinite-scroll="$ctrl.loadMoreUnits()" infinite-scroll-use-document-bottom="false" infinite-scroll-parent="true" infinite-scroll-distance="1">
    <li class="list-group-item" ng-repeat="unit in $ctrl.units">
      <span class="angularButton" ng-click="showVersions = !showVersions" ng-init="showVersions=false">{{unit.unitId}}</span>
      <ul class="list-group" ng-if="showVersions">
        <li layout="row" class="list-group-item" ng-repeat="version in unit.versions" ng-init="version.repositoriesLoaded=false">
          <span class="angularButton" ng-click="$ctrl.getRepositoriesForVersion(unit.unitId, version)" ng-init="version.showRepositories=false">{{version.version}}</span>
          <md-button class="md-icon-button md-primary" ng-if="!$ctrl.shoppingCart.isInCart(unit.unitId, version.version)" ng-click="$ctrl.shoppingCart.addUnit(unit.unitId, version.version)"><i class="material-icons">shopping_cart</i></md-button>
          <md-button class="md-icon-button md-warn" ng-if="$ctrl.shoppingCart.isInCart(unit.unitId, version.version)" ng-click="$ctrl.shoppingCart.removeUnit(unit.unitId, version.version)"><md-icon>remove_shopping_cart</md-icon></md-button>
          <ul class="list-group" ng-if="version.showRepositories">
            <li class="list-group-item" ng-repeat="repository in version.repositoriesWithVersion">
              <span class="angularButton" ng-click="$ctrl.filterUnitsByRepo(repository)">{{repository.uri}}</span>
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
  <div layout="row" layout-padding layout-align="space-around">
    <md-progress-circular ng-if="$ctrl.unitsAreLoading" md-mode="indeterminate"></md-progress-circular>
    <h3 ng-if="$ctrl.allUnitsLoaded">You have reached the end</h3>
  </div>
</md-content>