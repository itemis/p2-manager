<!doctype html>
<html lang="en" ng-app="com.itemis.p2-manager-frontend">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>p2-Manager</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">

    <!-- P2-Manager Frontend CSS -->
    <link rel="stylesheet" type="text/css" href="style.css">

    <!-- jQuery.js -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>

    <!-- Angular.js -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.3/angular.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-filter/0.5.17/angular-filter.min.js"></script>

    <!-- ngInfiniteScroll -->
    <script type='text/javascript' src='lib/ng-infinite-scroll/ng-infinite-scroll.js'></script>

    <!-- Bootstrap.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>

    <!-- P2-Manager Frontend Logic -->
     <script src="Controllers.js"></script>
  </head>

  <body>
    <div class="container px-5" ng-controller="P2MController">
      <div class="m-3">
        <h1 class="display-3 p-4 text-center">p2-Manager</h1>
        <hr>
      </div>

      <div class="row">
        <div class="col-lg-6">
          <h2 class="m-2">Add Repository</h2>
          <form class="form-inline" ng-submit="addRepository()" name="newRepositoryForm">
            <label class="m-1" for="repositoryURL">Repository URL:</label>
            <input class="form-control m-1" name="repositoryURL" type="url" size="35" id="repositoryURL" ng-model="repositoryURL" required>
            <button type="button" class="btn m-1" ng-click="addRepository()" ng-disabled="newRepositoryForm.repositoryURL.$invalid">Add</button>
          </form>
          
          <h2 class="m-2">Search Repositories</h2>
          <form class="form-inline" ng-submit="searchRepositories()" name="searchRepositoriesForm">
            <input class="form-control m-1" name="repoId" type="text" size="50" id="repoId" ng-model="repoId" ng-model-options="{debounce:300}" ng-change="searchRepositories()">
            <button type="button" class="btn m-1" ng-click="searchRepositories()">Search</button>
          </form>

          <h2 class="m-2 text-center">Repositories</h2>

          <table class="" name="Repositories">
            <ul class="list-group" infinite-scroll="loadMoreRepositories()" infinite-scroll-use-document-bottom="false" infinite-scroll-parent="false" infinite-scroll-distance="1">
              <li class="list-group-item" ng-repeat="repository in repositories | orderBy:'uri'" ng-controller="RepositoryUnitController">
                <span class="angularButton" ng-click="getUnitsForRepo()" ng-init="showUnits=false">{{repository.uri}}</span>
                <ul class="list-group" ng-if="showUnits">
                  <li class="list-group-item" ng-if="unitsInRepository.length <= 0">No units in this repository.</li>
                  <li class="list-group-item" ng-repeat="(unitid, units) in unitsInRepository | groupBy: 'unitId' | orderBy:'unitId'">
                    <span class="angularButton" ng-click="showVersions = !showVersions" ng-init="showVersions=false">{{unitid}}</span>
                    <ul class="list-group" ng-if="showVersions">
                      <li class="list-group-item" ng-repeat="unit in units">
                        {{unit.version}}
                      </li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </table>
          <div class="m-3 text-center">
            <img src="resource/loadingIcon.gif" ng-if="repositoriesAreLoading">
            <h3 ng-if="allRepositoriesLoaded">You have reached the end</h3>
          </div>
        </div>
        
        
        <div class="col-lg-6">
          <h2 class="m-2">Search Installable Units</h2>
          <form class="form-inline" ng-submit="searchUnits()" name="searchUnitsForm">
            <input class="form-control m-1" name="unitId" type="text" size="50" id="unitId" ng-model="unitId" ng-model-options="{debounce:300}" ng-pattern='unitIdFormat' ng-change="searchUnits()">
            <button type="button" class="btn m-1" ng-click="searchUnits()" ng-disabled="searchUnitsForm.unitId.$invalid">Search</button>
          </form>

          <h2 class="m-3 text-center">Installable Units</h2>
          <table class="" name="Units">
            <ul class="list-group" infinite-scroll="loadMoreUnits()" infinite-scroll-use-document-bottom="false" infinite-scroll-parent="false" infinite-scroll-distance="1">
              <li class="list-group-item" ng-repeat="(unitid, units) in units | groupBy: 'unitId' | orderBy:'unitId'">
                <span class="angularButton" ng-click="showVersions = !showVersions" ng-init="showVersions=false">{{unitid}}</span>
                <ul class="list-group" ng-if="showVersions">
                  <li class="list-group-item" ng-repeat="unit in units" ng-controller="UnitController">
                    <span class="angularButton" ng-click="getRepositoriesForVersion()" ng-init="showVersions=false">{{unit.version}}</span>
                    <ul class="list-group" ng-if="showRepositories">
                      <li class="list-group-item" ng-repeat="repository in repositoriesWithVersion">
                        {{repository.uri}}
                      </li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </table>
          <div class="m-3 text-center">
            <img src="resource/loadingIcon.gif" ng-if="unitsAreLoading">
            <h3 ng-if="allUnitsLoaded">You have reached the end</h3>
          </div>
        </div>
      </div>

      <div id="footer">
        <hr>
      </div>

    </div>
  </body>
</html>